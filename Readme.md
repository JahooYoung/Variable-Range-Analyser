# 2018年春 编译技术 Project 
杨嘉宏 1600012769

## 使用说明
1. 项目代码中已有`Makefile`，可以直接使用`make`命令
2. `./vra`是该项目的可执行文件，用法是`./vra {ssa file}`，比如`./vra ./benchmark/t2.ssa`。执行时，若需要输入变量范围，程序会给出提示，比如`k in`，此时输入两个用空格分开的数即可，比如`k in -inf 0`。程序执行完成之后，会输出`foo`函数返回的结果，如`_10 in [100,100]`。

## 代码说明
- main.cpp
这是项目的入口，它把ssa文件中的每个函数构造成一个`VariableRangeAnalyser`类，最后执行`foo`函数的范围分析。
- VariableRangeAnalyser.h/cpp
这两个文件主要实现`VariableRangeAnalyser`类。构造该类的一个实例时，它会先将ssa转换成控制流图，然后对该控制流图作一些变换（即论文中要将分支中涉及的变量根据条件的真假构造一个新变量并用该新变量替换掉相应的旧变量）。然后它会根据变换后的控制流图构造（变量之间的）约束图。之后的变量范围分析只在约束图上进行。
- SsaGraph.h/cpp
这两个文件主要实现`SsaGraph`类。该类的主要任务是对ssa文件中的一个函数进行语法分析并构造出相应的控制流图。鉴于ssa文件中的词都比较简单，词之间也基本有空格分开，故我只做了一个很简单的词法分析器。语法分析则根据每个语句的开头直接判断该语句的类型，然后根据该类型直接对号入座。上述变换的代码实现也在这两个文件中。
- ConstraintGraph.h/cpp
这两个文件主要实现`ConstraintGraph`类。该类用于表示约束图，约束图的结点类型是`Variable`类。考虑到一个变量最多只能有一个约束条件来约束，故我把两者放在同一个类中。
构造该约束图比较简单，基本上就是控制流图中的一个语句构造一个约束条件，然后跟用到的变量连边即可。比较特殊的是函数调用。对于这种约束条件，考虑到性能，我做了**函数内联**，即把该约束条件展开成相应函数的约束图嵌进当前的约束图中。
执行范围分析时则先把参数对应的变量的范围设置好，然后按照论文所说的三个步骤进行迭代更新，最后输出return的变量的范围。
- Utility.h/cpp
这两个文件主要定义了两个类`Lattice_Z`和`Interval`以实现区间的运算。